clc;clear;close all

xrange = [-15,0,15];
yrange = [-15,0,15];

for ix = 1:length(xrange)
    for iy = 1:length(yrange)
%%
    subplot(length(xrange),length(yrange),(ix-1)*length(yrange) + iy)
    nens = 10e6;
    ndim = 2;

    V = [1,-1;1,1];
    S = [10,0;0,1];

    M = V'*S*V;

    ens = mvnrnd([xrange(ix),yrange(iy)],[10,0;0,0.01],nens);

    % ens(ens(:,2)<0) = 0;
    %%
%     figure
%     nbins=[50 50];
%     [N,C]=hist3(ens,nbins);
%     lN = log(N);
%     lN(lN==-inf)=0;
%     contourf(C{1},C{2},lN',50)

    %%

    H = [0,1;1,0];

    %h = @(x) EW09_obs(x')';
    h = @(x) [x(:,1) + x(:,2);x(:,1)];
    
%     yensp = h(ens);
%     yens  = yensp(:,[1,4]);

    %%
    nbins=[100 100];
    [N,C]=hist3(yens,nbins);
    lN = log(N);
    lN(lN==-inf)=0;
    %%
%     figure
    contourf(C{1},C{2},lN',10)
    end
end
